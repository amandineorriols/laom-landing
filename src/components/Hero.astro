---
import { getTranslations } from '~/i18n/utils'

const lang = Astro.currentLocale || 'fr'
const t = getTranslations(lang as 'fr' | 'en')

const heroVideoSrc = '/videos/aveyron_hero.webm'
const heroImageFallback = '/images/hero-bg.jpg'
---

<section id="home" class="relative min-h-[70vh] flex items-center justify-center overflow-hidden">
  <!-- Background Video/Image with natural fallback -->
  <div class="absolute inset-0 z-0">
    <!-- Natural gradient background as fallback (forest/rural colors) -->
    <div class="absolute inset-0 bg-gradient-to-br from-[#2d5016] via-[#3a6030] to-[#1a3320]"></div>
    
    <!-- Video Background (inspired by Our Habitas) -->
    <video
      id="hero-video"
      class="absolute inset-0 w-full h-full object-cover"
      autoplay
      muted
      loop
      playsinline
      preload="auto"
      poster={heroImageFallback}
    >
      <source src={heroVideoSrc} type="video/webm" />
    </video>
    
    <!-- Image fallback (shown if video doesn't load) -->
    <div 
      id="hero-image-fallback"
      class="absolute inset-0 bg-cover bg-center hidden" 
      style="background-image: url('{heroImageFallback}'); background-position: center; background-size: cover;"
    ></div>
    
    <!-- Gradient overlay for text readability (inspired by Our Habitas) -->
    <div class="absolute inset-0 bg-gradient-to-b from-black/40 via-black/30 to-black/50"></div>
    <!-- Additional natural overlay -->
    <div class="absolute inset-0 bg-[#2d5016]/10"></div>
  </div>

  <!-- Content – Citadel Garden style -->
  <div class="relative z-20 text-center px-10 sm:px-16 lg:px-24 max-w-6xl mx-auto opacity-0 translate-y-8 animate-fade-in-up" style="animation-delay: 0.2s;">
    <!-- Main title -->
    <h1 class="text-6xl md:text-7xl lg:text-8xl font-normal tracking-tight text-white mb-6 leading-[0.95] drop-shadow-lg">
      {t.hero.title}
    </h1>
    
    <!-- Tagline -->
    <p class="text-xl md:text-2xl lg:text-3xl font-normal text-white/95 drop-shadow-sm max-w-4xl mx-auto">
      {t.hero.tagline}
    </p>
  </div>

  <!-- Scroll Indicator – arrow in circle (minimal) -->
  <a
    href="#experience"
    aria-label="Scroll to content"
    class="absolute bottom-10 left-1/2 -translate-x-1/2 z-20 text-white/90 hover:text-white transition-colors"
  >
    <svg class="w-10 h-10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
      <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="1.5" />
      <polygon points="9,10 15,10 12,15" fill="currentColor" />
    </svg>
  </a>
</section>

<script>
  // Handle video loading errors - fallback to image
  const heroVideo = document.getElementById('hero-video')
  const heroImageFallback = document.getElementById('hero-image-fallback')
  
  if (heroVideo) {
    heroVideo.addEventListener('error', () => {
      // Video failed to load, show image fallback
      if (heroImageFallback) {
        heroVideo.style.display = 'none'
        heroImageFallback.classList.remove('hidden')
      }
    })
    
    heroVideo.addEventListener('loadeddata', () => {
      // Video loaded successfully
      if (heroImageFallback) {
        heroImageFallback.classList.add('hidden')
      }
    })
    
    // Try to play the video (required for autoplay in some browsers)
    ;(heroVideo as HTMLVideoElement).play().catch(() => {
      // Autoplay failed, show image fallback
      if (heroImageFallback) {
        heroVideo.style.display = 'none'
        heroImageFallback.classList.remove('hidden')
      }
    })
  }
</script>
