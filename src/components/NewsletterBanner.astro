---
import { getTranslations } from '~/i18n/utils'

const lang = Astro.currentLocale || 'fr'
const t = getTranslations(lang as 'fr' | 'en')
const b = t.home.newsletterBanner

// Kit form options – same structure as NewsletterForm (form behavior, success, powered by)
const formKitOptions = {
  settings: {
    after_subscribe: {
      action: 'message',
      success_message: lang === 'fr'
        ? 'Parfait ! Consultez votre boîte mail pour confirmer votre inscription.'
        : 'Success! Now check your email to confirm your subscription.',
      redirect_url: '',
    },
    analytics: { google: null, fathom: null, facebook: null, segment: null, pinterest: null, sparkloop: null, googletagmanager: null },
    modal: { trigger: 'timer', scroll_percentage: null, timer: 5, devices: 'all', show_once_every: 15 },
    powered_by: { show: true, url: 'https://kit.com/features/forms?utm_campaign=poweredby&utm_content=form&utm_medium=referral&utm_source=dynamic' },
    recaptcha: { enabled: false },
    return_visitor: { action: 'show', custom_content: '' },
    slide_in: { display_in: 'bottom_right', trigger: 'timer', scroll_percentage: null, timer: 5, devices: 'all', show_once_every: 15 },
    sticky_bar: { display_in: 'top', trigger: 'timer', scroll_percentage: null, timer: 5, devices: 'all', show_once_every: 15 },
  },
  version: '5',
}
---

<section class="py-24 md:py-32 bg-[#F3EEDC]">
  <div class="max-w-4xl mx-auto px-10 sm:px-16 lg:px-24">
    <div class="bg-[#285230] rounded-3xl md:rounded-[2.5rem] p-8 md:p-12 lg:p-16 text-center">
      <h2 class="text-3xl md:text-4xl lg:text-5xl font-normal text-white mb-4 tracking-tight">
        {b.headline}
      </h2>
      <p class="text-base md:text-lg font-normal text-white/90 leading-relaxed mb-8 max-w-2xl mx-auto">
        {b.description}
      </p>
      <div class="newsletter-form-widget newsletter-form-widget--light">
      <form
        action="https://app.kit.com/forms/8987350/subscriptions"
        class="seva-form formkit-form"
        method="post"
        data-sv-form="8987350"
        data-uid="af2e0fc1e5"
        data-format="inline"
        data-version="5"
        data-options={JSON.stringify(formKitOptions).replace(/"/g, '&quot;').replace(/&/g, '&amp;')}
        min-width="400 500 600 700 800"
      >
        <div data-style="clean">
          <ul class="formkit-alert formkit-alert-error" data-element="errors" data-group="alert" aria-live="polite"></ul>
          <div data-element="fields" data-stacked="false" class="seva-fields formkit-fields flex flex-col sm:flex-row gap-3 justify-center max-w-xl mx-auto">
            <div class="formkit-field flex-1 min-w-[200px]">
              <input
              class="formkit-input w-full rounded-xl px-5 py-4 font-normal text-sm focus:outline-none transition-colors bg-white border border-white/20 text-[#285230] placeholder-[#285230]/60 focus:border-white focus:ring-2 focus:ring-white/40"
              name="email_address"
              type="email"
              required
              aria-label={b.placeholder}
              placeholder={b.placeholder}
              autocomplete="email"
            />
          </div>
          <button
            type="submit"
            data-element="submit"
            class="formkit-submit px-8 py-4 rounded-xl font-bold text-sm tracking-wider uppercase focus:outline-none transition-colors relative bg-[#d4af37] border border-[#d4af37] text-[#285230] hover:bg-[#e5c04a] hover:border-[#e5c04a] focus-visible:ring-2 focus-visible:ring-[#d4af37]/50 focus-visible:ring-offset-2 focus-visible:ring-offset-[#285230] whitespace-nowrap"
          >
            <div class="formkit-spinner" aria-hidden="true">
              <div></div>
              <div></div>
              <div></div>
            </div>
            <span>{b.cta}</span>
          </button>
        </div>
          <div class="formkit-powered-by-convertkit-container mt-4">
            <a
              href="https://kit.com/features/forms?utm_campaign=poweredby&amp;utm_content=form&amp;utm_medium=referral&amp;utm_source=dynamic"
              data-element="powered-by"
            class="formkit-powered-by-convertkit text-xs font-normal transition-colors text-white/50 hover:text-white/70"
            data-variant="dark"
            target="_blank"
            rel="noopener noreferrer nofollow"
            aria-label="Built with Kit (opens in new tab)"
            >
              Built with Kit
            </a>
          </div>
        </div>
      </form>
    </div>
    </div>
  </div>
</section>
